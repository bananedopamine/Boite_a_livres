{# @author : Dufour Marc (marc.dufour@stjosup.com)
 # @version : 1
 # @dateCreate : 12/01/2026
 # @lastUpdate : 12/01/2026
 #}

{% extends 'base.html.twig' %}

{% block title %}Liste des livres{% endblock %}

{% block body %}
    <h1>Liste des livres en stock</h1>

    {% include 'livre/_search_form.html.twig' %}

    {% set itemsToDisplay = [] %}
    {% for livre in livres %}
        {% if (app.session.get('admin_authenticated')) or (livre.NbStock > 0) %}
            {% set itemsToDisplay = itemsToDisplay|merge([livre]) %}
        {% endif %}
    {% endfor %}

    {% if itemsToDisplay|length > 0 %}
        <table class="table">
            <thead>
                <tr>
                    <th>ISBN</th>
                    <th>Nom</th>
                    <th>Auteur</th>
                    <th>Stock</th>
                    {% if app.session.get('admin_authenticated') %}
                        <th>Actions</th>
                    {% endif %}
                </tr>
            </thead>
            <tbody>
                {% for livre in itemsToDisplay %}
                    <tr>
                        <td><a href="{{ path('app_livre_show', {'id': livre.id}) }}">{{ livre.isbn }}</a></td> 
                        <td>{{ livre.nom }}</td>
                        <td>{{ livre.auteur }}</td>
                        <td>{{ livre.NbStock }}</td>
                        {% if app.session.get('admin_authenticated') %}
                        <td>
                            <a href="{{ path('app_livre_edit', {'id': livre.id}) }}">Modifier</a>
                        </td>
                        {% endif %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <div class="alert alert-warning mt-3">
            {% if last_isbn or last_auteur %}
                Aucun livre ne correspond à votre recherche (
                {% if last_isbn %}ISBN: {{ last_isbn }}{% endif %}
                {% if last_isbn and last_auteur %} - {% endif %}
                {% if last_auteur %}Auteur: {{ last_auteur }}{% endif %}
                ).
            {% else %}
                Aucun livre n'est actuellement disponible en stock.
            {% endif %}
            <div>
                <a href="{{ path('app_livre_index') }}" class="btn btn-sm btn-outline-secondary">
                    Voir toute la bibliothèque
                </a>
            </div>
        </div>
    {% endif %}
{% endblock %}