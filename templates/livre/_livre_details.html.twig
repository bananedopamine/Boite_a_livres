{# 
 # @fileName : livre/_livre_details.html.twig
 # @author : Dufour Marc (marc.dufour@stjosup.com)
 # @version : 2.2
 # @dateCreate : 12/01/2026
 # @lastUpdate : 11/02/2026 (ajout des entêtes)
 #}

<div class="table-wrapper-large">
    <h1 style="margin: 1rem; color: var(--accent);">Détails du Livre</h1>
    
    {# Affichage de l'image si disponible #}
    {% if livre.lienImg %}
        <div style="text-align: center; margin: 1rem 0;">
            <img src="{{ livre.lienImg }}" 
                 alt="Couverture de {{ livre.titre }}" 
                 style="max-width: 150px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
        </div>
    {% endif %}
    
    <table class="table table-striped">
        <tbody>
            <tr>
                <th>ISBN</th>
                <td>{{ livre.isbn }}</td> 
            </tr>
            <tr>
                <th>Titre</th>
                <td><strong>{{ livre.titre }}</strong></td>
            </tr>
            <tr>
                <th>Auteur</th>
                <td>{{ livre.auteur }}</td>
            </tr>
            {% if livre.genre %}
            <tr>
                <th>Genre</th>
                <td>{{ livre.genre }}</td>
            </tr>
            {% endif %}
            <tr>
                <th>Description</th>
                <td>
                    {% set description = livre.description|default('') %}
                    {% if description|length > 0 %}
                        <div class="description-preview">
                            {# Afficher une version tronquée #}
                            <div class="description-truncated">
                                {{ description|striptags|slice(0 , 50) ~ '...' }}
                            </div>

                            {# Bouton "Voir plus" seulement si la description est longue (plus de 150 caractères) #}
                            {% if description|length > 50 %}
                                <button type="button" 
                                        class="btn-voir-plus" 
                                        data-full-description="{{ description|e('html_attr') }}">
                                    Voir plus <i class="fas fa-chevron-down"></i>
                                </button>
                            {% endif %}
                        </div>
                    {% else %}
                        <em style="color: var(--text-light);">Aucune description disponible</em>
                    {% endif %}
                </td>
            </tr>
            <tr>
                <th>Stock</th>
                <td>
                    <span class="badge {{ livre.NbStock > 0 ? 'bg-success' : 'bg-danger' }}">
                        {{ livre.NbStock }} exemplaire(s)
                    </span>
                </td>
            </tr>
            {% if app.session.get('admin_authenticated') %}
                <tr>
                    <th>Statut</th>
                    <td>
                        <span class="badge {{ livre.actif ? 'bg-success' : 'bg-secondary' }}">
                            {{ livre.actif ? 'Actif' : 'Inactif' }}
                        </span>
                    </td>
                </tr>
            {% endif %}
        </tbody>
    </table>
</div>

    <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 15px;">
        <button type="button" onclick="document.getElementById('modale_principale').close()" class="btn-modal-close">Fermer</button>
        {% if app.session.get('admin_authenticated') %}
        {# Bouton Modifier #}

        <button type="button" 
                class="btn btn-primary btn-modifier-livre"
                data-livre-id="{{ livre.id }}"
                data-modal-url="{{ path('app_livre_edit', {'id': livre.id}) }}">
            <i class="fas fa-edit"></i> Modifier
        </button>
        
        {# Bouton Supprimer #}
        <button type="button" 
                class="btn btn-danger"
                onclick="document.getElementById('confirm-delete-modal').showModal()">Supprimer
        </button>

        {# Modale de confirmation de suppression (imbriquée) #}
        <dialog id="confirm-delete-modal" style="border-radius: 8px; border: 1px solid #ccc; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); max-width: 500px;">
            <h3 style="margin-top: 0; color: #d32f2f;">
                Confirmer la suppression
            </h3>
            <p>Êtes-vous sûr de vouloir supprimer le livre <strong>{{ livre.titre }}</strong> ?</p>
            <p style="color: #d32f2f; font-size: 0.9em;">
                <i class="fas fa-info-circle"></i> Cette action marquera le livre comme inactif.
            </p>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button type="button" 
                        class="btn btn-secondary"
                        onclick="document.getElementById('confirm-delete-modal').close()">
                    Annuler
                </button>
                
                <a href="{{ path('app_livre_delete', {'id': livre.id})}}">
                    <button type="button" class="btn btn-danger">
                        Confirmer la suppression
                    </button>
                </a>
            
            {% endif %}
            </div>
        </dialog>
    </div>
