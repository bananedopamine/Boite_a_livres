{# @author : Dufour Marc (marc.dufour@stjosup.com)
 # @version : 1.1
 # @lastUpdate : 19/01/2026 (Ajout classe pour interception AJAX)
 #}

<h1>Détails du Livre</h1>
<table>
    <tbody>
        <tr>
            <th>ISBN</th>
            <td>{{ livre.isbn }}</td> 
        </tr>
        <tr>
            <th>titre</th>
            <td>{{ livre.titre }}</td>
        </tr>
        <tr>
            <th>Auteur</th>
            <td>{{ livre.auteur }}</td>
        </tr>
        <tr>
            <th>Description</th>
            <td>{{ livre.description }}</td>
        </tr>
        <tr>
            <th>LienImg</th>
            <td>{{ livre.lienImg }}</td>
        </tr>
        <tr>
            <th>NbStock</th>
            <td>{{ livre.NbStock }}</td>
        </tr>
        {% if app.session.get('admin_authenticated') %}
            <tr>
                <th>actif</th>
                <td>
                    {% if livre.actif %}
                        <span>Actif</span>
                    {% else %}
                        <span>Inactif</span>
                    {% endif %}
                </td>
            </tr>
        {% endif %}
    </tbody>
</table>

<div style="display: flex; gap: 10px;">
    {# 
       IMPORTANT : Ajout de la classe 'edit-modal-trigger' 
       C'est ce qui permet au JavaScript de l'index d'intercepter le clic 
       et de charger le formulaire dans la même modale.
    #}
{% if app.session.get('admin_authenticated') %}
    <a href="{{ path('app_livre_edit', {'id': livre.id}) }}" class="edit-modal-trigger">
        <button type="button">Modifier</button>
    </a>
    
    {# On remplace le lien direct par un bouton déclenchant la modale de confirmation #}
    <button type="button" 
            style="background-color: #d32f2f; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;"
            onclick="document.getElementById('confirm-delete-modal').showModal()">
        Supprimer
    </button>

    {# Modale de confirmation de suppression (imbriquée) #}
    <dialog id="confirm-delete-modal" style="border-radius: 8px; border: 1px solid #ccc; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
        <h3 style="margin-top: 0;">Confirmer la suppression</h3>
        <p>Êtes-vous sûr de vouloir supprimer le livre <strong>{{ livre.titre }}</strong> ?</p>
        <p style="color: #d32f2f; font-size: 0.9em;">Cette action est irréversible.</p>
        
        <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
            <button type="button" 
                    onclick="document.getElementById('confirm-delete-modal').close()"
                    style="background: #ccc; border: none; padding: 5px 15px; border-radius: 4px;">
                Annuler
            </button>
            
            
            <a href="{{ path('app_livre_delete', {'id': livre.id})}}">
                <button></button>
            </a>
            {# On inclut le formulaire de suppression réel ici #}
            {# {{ include('livre/_delete_form.html.twig') }} #}
        </div>
    </dialog>
{% endif %}
</div>