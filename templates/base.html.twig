{# @author : Dufour Marc (marc.dufour@stjosup.com)
 # @version : 2.0
 # @dateCreate : 12/01/2026
 # @lastUpdate : 10/02/2026 (Centralisation des templates HTML5)
 #}

<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <title>{% block title %}Gestion Stock - IES{% endblock %}</title>
        
        {# Intégration de Simple.css #}
        <link rel="stylesheet" href="{{ asset('css/style.css') }}">
        
        {% block stylesheets %}{% endblock %}
    </head>
    <body>
        <header>
            <nav>
                <div class="inline-container">
                    <a class="logo-home" href="{{path('home_index')}}" >
                        <img src="{{ asset('extras/images/245-MRK.ERG.506_LogoTransparent_v1.0.png') }}" alt="Accueil" style="width: 200px; height: auto;" align="center">
                    </a>
                    
                    <h1>{% block PageTitle %}Ma Boîte à Livres{% endblock %}</h1>

                    <div style="display:flex;">
                        {% if app.session.get('admin_authenticated') %}
                        {# DROPDOWN MENU ADMIN #}
                            <div class="dropdown">
                                <button class="dropdown-toggle" id="adminDropdown" type="button">
                                    Admin
                                </button>
                                <div class="dropdown-menu" id="adminMenu">
                                    <a href="{{ path('app_livre_index') }}" class="dropdown-item">
                                        Bibliothèque
                                    </a>
                                    <a href="{{ path('app_mouvement_index') }}" class="dropdown-item">
                                        Historique des mouvements
                                    </a>
                                    <div class="dropdown-divider"></div>
                                    <a href="{{ path('app_admin_settings') }}" class="dropdown-item">
                                        Paramètres
                                    </a>
                                    <div class="dropdown-divider"></div>
                                    <a href="{{ path('app_admin_logout') }}" class="dropdown-item danger">
                                        Déconnexion
                                    </a>
                                </div>
                            </div>
                        {% else %}
                            <a href="{{ path('app_admin_login') }}" class="btn-horloge" id="btn-horloge">Admin</a>
                        {% endif %}
                    </div>
                </div>
            </nav>
        </header>

        <main>
            
            {% for label, messages in app.flashes %}
                {% for message in messages %}
                    <div class="alert alert-{{ label }} flash-message alert-dismissible fade show" role="alert">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endfor %}

            {% block body %}{% endblock %}

            {# =========================================
               TEMPLATES HTML5 GLOBAUX
               Disponibles sur toutes les pages
               ========================================= #}
            
            {# Templates globaux (filtres, etc.) #}
            {% include 'partials/_templates_global.html.twig' %}
            
            {# Templates pour les mouvements (scan ISBN, création livre) #}
            {% include 'partials/_templates_mouvement_modal.html.twig' %}
            
            {# Templates pour les suggestions de livres #}
            {% include 'partials/_templates_suggestion.html.twig' %}
            
            {# Templates pour l'affichage des livres (si vous en avez) #}
            {% include 'partials/_templates_livre.html.twig' %}
            
            {# Templates pour les mouvements (si différents des modaux) #}
            {% include 'partials/_templates_mouvement.html.twig' %}
        
        </main>
        
        {# Modale principale pour le contenu dynamique (AJAX) #}
        <dialog id="modale_principale" class="modal-main">
            <div id="contenu_modale">
                
            </div>
        </dialog>

         <footer>
            <p>&copy; {{ "now"|date("Y") }} - IES Ingénierie</p>
        </footer>

        {# IMPORTANT : Charger template_helpers.js EN PREMIER #}
        <script src="{{ asset('js/template_helpers.js') }}"></script>

        {# Fonctions communes réutilisables #}
        <script src="{{ asset('js/fonctions.js') }}"></script>

        {# Initialisation de la page de base #}
        <script src="{{ asset('js/base_initialization.js') }}"></script>

        <script src="{{ asset('js/modal_handler.js') }}"></script>
        <script src="{{ asset('js/modal_filtres_livre_handler.js') }}"></script>
        <script src="{{ asset('js/modal_filtres_mouvement_handler.js') }}"></script>
        <script src="{{ asset('js/modal_succes_handler.js') }}"></script>

        {# Fonction pour l'horloge #}
        <script src="{{ asset('js/horloge_bouton.js') }}"></script>
        
        {# Chargement conditionnel selon la route #}
        {% if app.request.attributes.get('_route') starts with 'app_livre' %}
            <script src="{{ asset('js/modal_filtres_livre_handler.js') }}"></script>
        {% elseif app.request.attributes.get('_route') starts with 'app_mouvement' %}
            <script src="{{ asset('js/modal_filtres_mouvement_handler.js') }}"></script>
        {% endif %}

        {% block javascripts %}{% endblock %}
    </body>
</html>
