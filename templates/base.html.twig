{# @author : Dufour Marc (marc.dufour@stjosup.com)
 # @version : 1.2
 # @dateCreate : 12/01/2026
 # @lastUpdate : 23/01/2026 (Migration vers Webapp Modale)
 #}

<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <title>{% block title %}Gestion Stock - IES{% endblock %}</title>
        
        {# Intégration de Simple.css #}
        <link rel="stylesheet" href="{{ asset('css/style.css') }}">
        
        {% block stylesheets %}{% endblock %}
    </head>
    <body>
        <header>
            <nav>
                <div class="inline-container">
                    <a class="logo-home" href="{{path('home_index')}}" >
                        <img src="{{ asset('extras/images/245-MRK.ERG.506_LogoTransparent_v1.0.png') }}" alt "Accueil" style="width: 200px; height: auto;" align="center">
                    </a>
                    
                    <h1>{% block PageTitle %}Ma Boîte à Livres{% endblock %}</h1>

                    <div style="display:flex;">
                        {% if app.session.get('admin_authenticated') %}
                        {# DROPDOWN MENU ADMIN #}
                            <div class="dropdown">
                                <button class="dropdown-toggle" id="adminDropdown" type="button">
                                    Admin
                                </button>
                                <div class="dropdown-menu" id="adminMenu">
                                    <a href="{{ path('app_livre_index') }}" class="dropdown-item">
                                        Bibliothèque
                                    </a>
                                    <a href="{{ path('app_mouvement_index') }}" class="dropdown-item">
                                        Historique des mouvements
                                    </a>
                                    <div class="dropdown-divider"></div>
                                    <a href="{{ path('app_admin_settings') }}" class="dropdown-item">
                                        Paramètres
                                    </a>
                                    <div class="dropdown-divider"></div>
                                    <a href="{{ path('app_admin_logout') }}" class="dropdown-item danger">
                                        Déconnexion
                                    </a>
                                </div>
                            </div>
                        {% else %}
                            <a href="{{ path('app_admin_login') }}" class="btn">Admin</a>
                        {% endif %}

                        <a href="javascript:history.back()" title="Retour">
                            <img src="{{ asset('extras/images/Back_arrow.png')}}" style="width: 50px" align="center" alt="Retour à la liste"> 
                        </a>
                    </div>
                </div>
            </nav>
        </header>

        <main>
            
            {% for label, messages in app.flashes %}
                {% for message in messages %}
                    <div class="alert alert-{{ label }} flash-message alert-dismissible fade show" role="alert">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endfor %}

            {% block body %}{% endblock %}

        

            


        </main>
        
        <dialog id="modale_principale" class="modal-main">
            <div id="contenu_modale">
                
            </div>
        </dialog>

         <footer>
            <p>&copy; {{ "now"|date("Y") }} - IES Ingénierie</p>
        </footer>

        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const notices = document.querySelectorAll('.flash-message');

                notices.forEach((notice) => {
                    setTimeout(() => {
                        notice.style.transition = "opacity 0.8s ease-out, transform 0.8s ease-out";
                        notice.style.opacity = "0";
                        notice.style.transform = "translateY(-20px)"; 

                        setTimeout(() => {
                            notice.remove();
                        }, 800);
                    }, 5000);
                });


                const dropdownBtn = document.getElementById('adminDropdown');
    const dropdownMenu = document.getElementById('adminMenu');

    if (dropdownBtn && dropdownMenu) {
        // Toggle au clic sur le bouton
        dropdownBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            dropdownMenu.classList.toggle('show');
        });

        // Fermer si on clique n'importe où ailleurs sur la page
        document.addEventListener('click', function() {
            dropdownMenu.classList.remove('show');
        });
    }
            });

                
            /**
                * Fonction globale pour ouvrir la modale et charger du contenu
                * Cette fonction sera utilisée par notre "cerveau" JS dans index.html.twig
                */
            async function chargerModale(url) {
                const modale = document.getElementById('modale_principale');
                const contenu = document.getElementById('contenu_modale');

                try {
                    const reponse = await fetch(url, {
                        headers: { 'X-Requested-With': 'XMLHttpRequest' }
                    });
                    const html = await reponse.text();
                    contenu.innerHTML = html;

                    if (!modale.open) {
                        modale.showModal();
                    }
                } catch (erreur) {
                    console.error("Erreur de chargement modale :", erreur);
                }
            }
        </script>

        <script src="{{ asset('js/modal_handler.js') }}"></script>
        <script src="{{ asset('js/modal_filtres_handler.js') }}"></script>
        <script src="{{ asset('js/modal_succes_handler.js') }}"></script>

        {% block javascripts %}{% endblock %}
    </body>
</html>