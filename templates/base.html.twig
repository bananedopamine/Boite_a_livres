{# @author : Dufour Marc (marc.dufour@stjosup.com)
 # @version : 1.2
 # @dateCreate : 12/01/2026
 # @lastUpdate : 22/01/2026 (Migration vers Webapp Modale)
 #}

<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <title>{% block title %}Gestion Stock - IES{% endblock %}</title>
        <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 128 128%22><text y=%221.2em%22 font-size=%2296%22>üìö</text></svg>">
        
        {# Int√©gration de Simple.css #}
        <link rel="stylesheet" href="https://cdn.simplecss.org/simple.min.css"> 
        <link rel="stylesheet" href="{{ asset('css/style.css') }}">
        
        {% block stylesheets %}{% endblock %}
    </head>
    <body>
        <header>
            <nav>
                <div>
                    <a href="{{ path('app_home') }}"><strong>Accueil</strong></a>
                    <a href="{{ path('app_livre_index') }}">Biblioth√®que</a>
                </div>
                <div>
                    {% if is_granted('ROLE_ADMIN') %}
                         <a href="{{ path('app_admin_dashboard') }}">Admin</a>
                    {% endif %}
                </div>
            </nav>
        </header>

        <main>
            {# Affichage des messages flash #}
            {% for label, messages in app.flashes %}
                {% for message in messages %}
                    <div class="alert alert-{{ label }} flash-message">
                        {{ message }}
                    </div>
                {% endfor %}{% endfor %}

            {% block body %}{% endblock %}
        </main>

        {# --- STRUCTURE UNIQUE POUR LES MODALES --- #}
        <dialog id="modale_principale" class="modal-main">
            <div id="contenu_modale">
                </div>
            <button type="button" onclick="document.getElementById('modale_principale').close()" class="btn-modal-close">Fermer</button>
        </dialog>

        <footer>
            <p>&copy; {{ "now"|date("Y") }} - IES Ing√©nierie</p>
        </footer>

        {# Scripts globaux #}
        <script>
            // Gestion automatique de la disparition des messages flash
            document.addEventListener('DOMContentLoaded', () => {
                const notifications = document.querySelectorAll('.flash-message');
                notifications.forEach((notice) => {
                    setTimeout(() => {
                        notice.style.transition = "opacity 0.8s ease-out";
                        notice.style.opacity = "0";
                        setTimeout(() => notice.remove(), 800);
                    }, 3000);
                });
            });

            /**
             * Fonction globale pour ouvrir la modale et charger du contenu
             * Cette fonction sera utilis√©e par notre "cerveau" JS dans index.html.twig
             */
            async function chargerModale(url) {
                const modale = document.getElementById('modale_principale');
                const contenu = document.getElementById('contenu_modale');
                
                try {
                    const reponse = await fetch(url, {
                        headers: { 'X-Requested-With': 'XMLHttpRequest' }
                    });
                    const html = await reponse.text();
                    contenu.innerHTML = html;
                    
                    if (!modale.open) {
                        modale.showModal();
                    }
                } catch (erreur) {
                    console.error("Erreur de chargement modale :", erreur);
                }
            }
        </script>
        {% block javascripts %}{% endblock %}
    </body>
</html>